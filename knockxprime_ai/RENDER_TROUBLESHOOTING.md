# Render Deployment Troubleshooting

## üö® Build Error Solutions

### Current Error: Rust Compilation Issues
The error occurs because some Python packages require Rust compilation, but Render's build environment has filesystem permission issues.

### Solution Options (Try in Order):

#### Option 1: Use Minimal Requirements (Recommended)
Update your **Build Command** in Render to:
```bash
pip install --upgrade pip && pip install -r requirements-minimal.txt
```

#### Option 2: Use Render-Optimized Requirements
Update your **Build Command** in Render to:
```bash
pip install --upgrade pip && pip install -r requirements-render.txt
```

#### Option 3: Force Pre-built Wheels Only
Update your **Build Command** in Render to:
```bash
pip install --upgrade pip && pip install -r requirements.txt --only-binary=all
```

#### Option 4: Skip Problematic Packages
Update your **Build Command** in Render to:
```bash
pip install --upgrade pip && pip install -r requirements.txt --no-deps && pip install fastapi uvicorn httpx python-jose python-multipart pydantic python-dotenv gunicorn passlib
```

## üìã Current Configuration

### Root Directory
```
knockxprime_ai
```

### Build Command (Try These)
```bash
# Option 1 (Recommended)
pip install --upgrade pip && pip install -r requirements-minimal.txt

# Option 2 (Alternative)
pip install --upgrade pip && pip install -r requirements-render.txt

# Option 3 (Force wheels)
pip install --upgrade pip && pip install -r requirements.txt --only-binary=all
```

### Start Command
```bash
uvicorn app.main:app --host 0.0.0.0 --port $PORT
```

## üîß Environment Variables Required

Set these in your Render dashboard:

1. **NEON_API_URL** = `https://ep-ancient-mountain-afykb78o.apirest.c-2.us-west-2.aws.neon.tech/neondb/rest/v1`
2. **NEON_API_KEY** = Your Neon database API key
3. **GROK_API_KEY** = Your Grok API key
4. **SECRET_KEY** = Auto-generated by Render
5. **RENDER_EXTERNAL_URL** = Your service URL (e.g., `https://your-service.onrender.com`)

## üêõ Common Issues & Solutions

### Issue 1: Rust Compilation Error
**Error**: `error: failed to create directory /usr/local/cargo/registry/cache`
**Solution**: Use requirements-minimal.txt (older, stable versions)

### Issue 2: Import Errors After Deployment
**Error**: `ModuleNotFoundError`
**Solution**: Check that all imports in the code match the installed packages

### Issue 3: Health Check Fails
**Error**: Service fails health check
**Solution**: Ensure `/health/` endpoint is accessible and returns 200

### Issue 4: Keep-Alive Not Working
**Error**: Service still goes to sleep
**Solution**: Set RENDER_EXTERNAL_URL to your actual service URL

## üì¶ Package Versions

### Minimal (Stable)
- fastapi==0.95.2
- uvicorn==0.22.0
- pydantic==1.10.7

### Render-Optimized
- fastapi==0.100.1
- uvicorn==0.23.2
- pydantic==1.10.12

### Current (May Have Issues)
- fastapi==0.104.1
- uvicorn==0.24.0
- pydantic==2.5.0 (requires Rust)

## üöÄ Deployment Steps

1. **Set Root Directory**: `knockxprime_ai`
2. **Set Build Command**: Use Option 1 from above
3. **Set Start Command**: `uvicorn app.main:app --host 0.0.0.0 --port $PORT`
4. **Add Environment Variables**: All 5 variables listed above
5. **Deploy**: Click deploy and monitor logs

## üìä Monitoring

### Health Check
- URL: `https://your-service.onrender.com/health/`
- Should return: `{"status": "healthy", ...}`

### API Documentation
- URL: `https://your-service.onrender.com/docs` (development only)
- Production: Contact support for API docs

### Logs
- Check Render dashboard logs for errors
- Look for "Keep-alive ping" messages
- Monitor response times

## üîÑ If All Else Fails

### Nuclear Option: Simplify Everything
Create a new `requirements-basic.txt`:
```
fastapi==0.88.0
uvicorn==0.20.0
httpx==0.23.0
python-dotenv==0.19.0
gunicorn==20.1.0
```

Then update build command to:
```bash
pip install -r requirements-basic.txt
```

This removes all authentication and advanced features but gets the basic API running.

## üìû Support

If none of these solutions work:
1. Check Render's Python documentation
2. Try deploying with a simpler requirements file
3. Contact Render support with the specific error message
4. Consider using a different deployment platform (Railway, Fly.io, etc.)